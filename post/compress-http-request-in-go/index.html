<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <title>
    Compress http request payload in go // Parthenon
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="Gzip http request payload in go ">
<meta name="keywords" content="go,golang,http,gzip,">
<meta name="author" content="Jijesh Mohan">

  <meta property="og:title" content="Compress http request payload in go" />
<meta property="og:description" content="Gzip http request payload in go" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="http://jijeshmohan.github.io/post/compress-http-request-in-go/" />


  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/base-min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
  
  
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/grids-responsive-min.css">
  
  

  <link rel="stylesheet" href="http://jijeshmohan.github.io//css/redlounge.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://jijeshmohan.github.io/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="http://jijeshmohan.github.io/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Parthenon" />

    
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_light.min.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  

  
</head>

<body>
	

	<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    

    <h1 class="brand-title">Parthenon</h1>
    <h2 class="brand-tagline">learnings and thoughts about programming</h2>

    <nav class="nav">
      <ul class="nav-list">
        <li class="nav-item"><span class="nav-item-separator">//</span><a href="http://jijeshmohan.github.io/">Home</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="http://jijeshmohan.github.io/about/">About</a></li>
        
      </ul>
    </nav>

    
    <div class="social-buttons">
      
        
        <a href="https://www.twitter.com/jijeshmohan" target="_blank"><i class='fa fa-twitter'></i></a>
        
      
        
        <a href="https://github.com/jijeshmohan" target="_blank"><i class='fa fa-github'></i></a>
        
      

    </div>
    

  </div>
</div>

	
	

    <div class="content pure-u-1 pure-u-md-3-4">
		<a name="top"></a>
		

		
  		<section class="post">
            <h1 class="post-title">
              <a href="http://jijeshmohan.github.io/post/compress-http-request-in-go">Compress http request payload in go</a>
            </h1>
            <h3 class="post-subtitle">
            	
            </h3>
            
            	<span class="post-date">
                	<span class="post-date-month">27 </span><span class="post-date-month">Dec</span> <span class="post-date-year">2015</span>
            	</span>
            	
            
            	
            		<span class="post-author-single">by <a class="post-author"  target="">Jijesh Mohan</a></span>
            		




            	
            

			
			
				<div class="post-categories">
				
					<a class="post-category post-category-golang" href="http://jijeshmohan.github.io//categories/golang">Golang</a>
				
				</div>
			

			

            <p>One of our product is using golang for the API server. There are multiple type of consumers, including mobile, web and even Smart TV ( in future ) for this API endpoints. One of the API is to send telemetry data from the client which is in json format. Due to the offline feature there are cases where the payload can be huge ( more than 1000 telemetry events in one request).</p>

<p>We did a calculation on the time it takes to sync 1000 events in one request in various network conditions and the results are:</p>

<p>
<figure >
    
        <img src="http://jijeshmohan.github.io/img/compress-http-result1.png" />
    
    
</figure>
</p>

<p>To reduce this time, we tried to use couple of binary serialization technique like Messagepack, protocol buffer etc. but due to the variety of the platforms, we need to support pure JSON format in some cases. So that it leads us to check the normal compression support like any modern web server supports for http response.</p>

<p>This helped us to continue with the same api endpoint with json format itself and with the help of ‘content-format’ header, endpoint determine whether it is a compressed content or not.</p>

<p>The power of golang reader interface can be seen here.</p>

<pre><code class="language-go">
func getData(r *http.Request) (*TelemetryEvents, error) {
	var data TelemetryEvents
	var decoder *json.Decoder
	switch r.Header.Get(&quot;Content-Encoding&quot;) {
	case &quot;gzip&quot;:
		gz, err := gzip.NewReader(r.Body)
		if err != nil {
			return nil, err
		}
		defer gz.Close()
		decoder = json.NewDecoder(gz)
	default:
		decoder = json.NewDecoder(r.Body)
	}
	err := decoder.Decode(&amp;data)
	if err != nil {
		return nil, err
	}
	return &amp;data, nil
}

</code></pre>

<p>and we have achieved the below numbers without any memory allocation overhead</p>

<p>
<figure >
    
        <img src="http://jijeshmohan.github.io/img/compress-http-result2.png" />
    
    
</figure>
</p>

	
			
		    	<div class="social-sharing">
	<a class="share-button-facebook" onClick="return popupShare(this.href);" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fjijeshmohan.github.io%2fpost%2fcompress-http-request-in-go%2f" target="_blank"><i class="fa fa-facebook"><span>Like</span></i></a>
	<a class="share-button-google-plus" onClick="return popupShare(this.href);" href="https://plus.google.com/share?url=http%3a%2f%2fjijeshmohan.github.io%2fpost%2fcompress-http-request-in-go%2f" target="_blank"><i class="fa fa-google-plus"><span>Google +1</span></i></a>
	<a class="share-button-linkedin" onClick="return popupShare(this.href);" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fjijeshmohan.github.io%2fpost%2fcompress-http-request-in-go%2f&title=Compress%20http%20request%20payload%20in%20go&summary=One%20of%20our%20product%20is%20using%20golang%20for%20the%20API%20server.%20There%20are%20multiple%20type%20of%20consumers%2c%20including%20mobile%2c%20web%20and%20even%20Smart%20TV%20%28%20in%20future%20%29%20for%20this%20API%20endpoints.%20One%20of%20the%20API%20is%20to%20send%20telemetry%20data%20from%20the%20client%20which%20is%20in%20json%20format.%20Due%20to%20the%20offline%20feature%20there%20are%20cases%20where%20the%20payload%20can%20be%20huge%20%28%20more%20than%201000%20telemetry%20events%20in%20one%20request%29.}&source=Parthenon" target="_blank"><i class="fa fa-linkedin"><span>Share on LinkedIn</span></i></a>
	<a class="share-button-twitter" onClick="return popupShare(this.href);" href="http://twitter.com/share?text=Compress%20http%20request%20payload%20in%20go&url=http%3a%2f%2fjijeshmohan.github.io%2fpost%2fcompress-http-request-in-go%2f" target="_blank"><i class="fa fa-twitter"><span>Tweet</span></i></a>	
</div>
		    

			

			
				<div class="paging">
					<span class="paging-label">More Reading</span>
					

					
					<div class="paging-older">
						<span class="dark-red">Older</span><span class="decorative-marker">//</span>
			            <a class="paging-link" href="http://jijeshmohan.github.io/post/gorillamux">Gorilla mux - Issue with order of routes</a>
		            </div>
		            
	            </div>
            
          </section>
          
          	<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'jijeshmohan';
    var disqus_identifier = 'http:\/\/jijeshmohan.github.io\/post\/compress-http-request-in-go\/';
    var disqus_title = 'Compress http request payload in go';
    var disqus_url = 'http:\/\/jijeshmohan.github.io\/post\/compress-http-request-in-go\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          
        
      <div class="footer">
	<hr class="thin" />
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
		<ul class="footer-menu">
		
		</ul>
	</div>

	<p>&copy; 2015. All rights reserved. </p>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63015273-1', 'auto');
  ga('send', 'pageview');

</script>
    </div>
  </div>
	

	
		<script type="text/javascript">
			function popupShare(url) {
				window.open(url, '_blank', 'scrollbars,resizable,height=525,width=600');
				return false;
			}
		</script>
	

  
</body>
</html>